{"ast":null,"code":"export class TextToSpeechService {\n  static async convertTextToSpeech(text) {\n    try {\n      console.log('Converting text to speech:', text);\n\n      // URL encode the text parameter\n      const encodedText = encodeURIComponent(text);\n      const url = `${this.API_BASE_URL}/api/text-to-speech?text=${encodedText}`;\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Accept': 'audio/*'\n        }\n      });\n      if (!response.ok) {\n        throw new Error(`TTS API request failed: ${response.status} ${response.statusText}`);\n      }\n\n      // Get the audio data as blob\n      const audioBlob = await response.blob();\n      console.log('TTS conversion successful, audio blob size:', audioBlob.size);\n      return {\n        success: true,\n        audioBlob: audioBlob\n      };\n    } catch (error) {\n      console.error('Text-to-speech conversion failed:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown TTS error'\n      };\n    }\n  }\n  static stopCurrentAudio() {\n    if (this.currentAudio) {\n      console.log('Stopping current audio playback');\n      this.currentAudio.pause();\n      this.currentAudio.currentTime = 0;\n      this.currentAudio = null;\n    }\n    if (this.currentAudioUrl) {\n      URL.revokeObjectURL(this.currentAudioUrl);\n      this.currentAudioUrl = null;\n    }\n  }\n  static async playAudio(audioBlob) {\n    return new Promise((resolve, reject) => {\n      try {\n        // Stop any currently playing audio first\n        this.stopCurrentAudio();\n\n        // Create audio URL from blob\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const audio = new Audio(audioUrl);\n\n        // Store references for management\n        this.currentAudio = audio;\n        this.currentAudioUrl = audioUrl;\n        audio.onended = () => {\n          console.log('Audio playback completed');\n          // Clean up the object URL\n          URL.revokeObjectURL(audioUrl);\n          this.currentAudio = null;\n          this.currentAudioUrl = null;\n          resolve();\n        };\n        audio.onerror = error => {\n          console.error('Audio playback error:', error);\n          URL.revokeObjectURL(audioUrl);\n          this.currentAudio = null;\n          this.currentAudioUrl = null;\n          reject(new Error('Audio playback failed'));\n        };\n\n        // Handle manual pause/stop\n        audio.onpause = () => {\n          if (audio.currentTime === 0) {\n            // Audio was stopped, not just paused\n            URL.revokeObjectURL(audioUrl);\n            this.currentAudio = null;\n            this.currentAudioUrl = null;\n            resolve();\n          }\n        };\n\n        // Start playing\n        console.log('Starting new audio playback');\n        audio.play().catch(reject);\n      } catch (error) {\n        console.error('Failed to create audio from blob:', error);\n        reject(error);\n      }\n    });\n  }\n  static async convertAndPlay(text) {\n    const result = await this.convertTextToSpeech(text);\n    if (result.success && result.audioBlob) {\n      await this.playAudio(result.audioBlob);\n    } else {\n      throw new Error(result.error || 'TTS conversion failed');\n    }\n  }\n}\nTextToSpeechService.API_BASE_URL = 'http://localhost:8080';\nTextToSpeechService.currentAudio = null;\nTextToSpeechService.currentAudioUrl = null;","map":{"version":3,"names":["TextToSpeechService","convertTextToSpeech","text","console","log","encodedText","encodeURIComponent","url","API_BASE_URL","response","fetch","method","headers","ok","Error","status","statusText","audioBlob","blob","size","success","error","message","stopCurrentAudio","currentAudio","pause","currentTime","currentAudioUrl","URL","revokeObjectURL","playAudio","Promise","resolve","reject","audioUrl","createObjectURL","audio","Audio","onended","onerror","onpause","play","catch","convertAndPlay","result"],"sources":["/Users/jiginvp/react/AICompetition/empathy-ai/src/services/textToSpeechService.ts"],"sourcesContent":["export interface TTSResponse {\n  success: boolean;\n  audioBlob?: Blob;\n  error?: string;\n}\n\nexport class TextToSpeechService {\n  private static readonly API_BASE_URL = 'http://localhost:8080';\n  private static currentAudio: HTMLAudioElement | null = null;\n  private static currentAudioUrl: string | null = null;\n\n  static async convertTextToSpeech(text: string): Promise<TTSResponse> {\n    try {\n      console.log('Converting text to speech:', text);\n      \n      // URL encode the text parameter\n      const encodedText = encodeURIComponent(text);\n      const url = `${this.API_BASE_URL}/api/text-to-speech?text=${encodedText}`;\n      \n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Accept': 'audio/*',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(`TTS API request failed: ${response.status} ${response.statusText}`);\n      }\n\n      // Get the audio data as blob\n      const audioBlob = await response.blob();\n      \n      console.log('TTS conversion successful, audio blob size:', audioBlob.size);\n      \n      return {\n        success: true,\n        audioBlob: audioBlob,\n      };\n      \n    } catch (error) {\n      console.error('Text-to-speech conversion failed:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown TTS error',\n      };\n    }\n  }\n\n  static stopCurrentAudio(): void {\n    if (this.currentAudio) {\n      console.log('Stopping current audio playback');\n      this.currentAudio.pause();\n      this.currentAudio.currentTime = 0;\n      this.currentAudio = null;\n    }\n    \n    if (this.currentAudioUrl) {\n      URL.revokeObjectURL(this.currentAudioUrl);\n      this.currentAudioUrl = null;\n    }\n  }\n\n  static async playAudio(audioBlob: Blob): Promise<void> {\n    return new Promise((resolve, reject) => {\n      try {\n        // Stop any currently playing audio first\n        this.stopCurrentAudio();\n        \n        // Create audio URL from blob\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const audio = new Audio(audioUrl);\n        \n        // Store references for management\n        this.currentAudio = audio;\n        this.currentAudioUrl = audioUrl;\n        \n        audio.onended = () => {\n          console.log('Audio playback completed');\n          // Clean up the object URL\n          URL.revokeObjectURL(audioUrl);\n          this.currentAudio = null;\n          this.currentAudioUrl = null;\n          resolve();\n        };\n        \n        audio.onerror = (error) => {\n          console.error('Audio playback error:', error);\n          URL.revokeObjectURL(audioUrl);\n          this.currentAudio = null;\n          this.currentAudioUrl = null;\n          reject(new Error('Audio playback failed'));\n        };\n        \n        // Handle manual pause/stop\n        audio.onpause = () => {\n          if (audio.currentTime === 0) {\n            // Audio was stopped, not just paused\n            URL.revokeObjectURL(audioUrl);\n            this.currentAudio = null;\n            this.currentAudioUrl = null;\n            resolve();\n          }\n        };\n        \n        // Start playing\n        console.log('Starting new audio playback');\n        audio.play().catch(reject);\n        \n      } catch (error) {\n        console.error('Failed to create audio from blob:', error);\n        reject(error);\n      }\n    });\n  }\n\n  static async convertAndPlay(text: string): Promise<void> {\n    const result = await this.convertTextToSpeech(text);\n    \n    if (result.success && result.audioBlob) {\n      await this.playAudio(result.audioBlob);\n    } else {\n      throw new Error(result.error || 'TTS conversion failed');\n    }\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}