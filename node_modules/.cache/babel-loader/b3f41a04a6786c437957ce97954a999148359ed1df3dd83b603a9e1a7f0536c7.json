{"ast":null,"code":"import React,{useState}from'react';import'./App.css';import AudioRecorder from'./components/AudioRecorder';import AudioPlayer from'./components/AudioPlayer';import TranscriptionHistory from'./components/TranscriptionHistory';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// Generate UUID function\nconst generateUUID=()=>{return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){const r=Math.random()*16|0;const v=c==='x'?r:r&0x3|0x8;return v.toString(16);});};function App(){const[isProcessing,setIsProcessing]=useState(false);const[currentResponse,setCurrentResponse]=useState(null);const[error,setError]=useState(null);const[conversations,setConversations]=useState([]);const[currentConversationUuid,setCurrentConversationUuid]=useState(null);const handleRecordingComplete=async audioBlob=>{// This is now handled by WebSocket, keeping for compatibility\nconsole.log('Recording complete - WebSocket mode');};const handleWebSocketMessage=message=>{console.log('Received WebSocket message:',message);if(message.type==='transcription'&&message.transcription){// Add user message with transcription\nconst userMessage={id:Date.now().toString(),timestamp:new Date(),type:'user',content:message.transcription};setConversations(prev=>{const updatedConversations=[...prev];if(updatedConversations.length>0){const currentMessages=[...updatedConversations[0].messages,userMessage];updatedConversations[0]={...updatedConversations[0],messages:currentMessages};}return updatedConversations;});}if(message.type==='ai_response'&&message.transcriptionReply){// Add AI response message\nconst aiMessage={id:(Date.now()+1).toString(),timestamp:new Date(),type:'ai',content:message.transcriptionReply,needHumanIntervention:message.needHumanIntervention||false};setConversations(prev=>{const updatedConversations=[...prev];if(updatedConversations.length>0){const currentMessages=[...updatedConversations[0].messages,aiMessage];updatedConversations[0]={...updatedConversations[0],messages:currentMessages};}return updatedConversations;});}if(message.error){setError(message.error);}};const handleWebSocketError=error=>{console.error('WebSocket error:',error);setError(error);};const handleStartNewConversation=()=>{const uuid=generateUUID();setCurrentConversationUuid(uuid);// Create new conversation\nconst newConversation={id:uuid,messages:[],startTime:new Date()};setConversations(prev=>[newConversation,...prev]);console.log('Started new conversation with UUID:',uuid);return uuid;};const handleEndConversation=()=>{setCurrentConversationUuid(null);console.log('Ended conversation');};const handlePlaybackComplete=()=>{// Optional: Add any cleanup or next steps after audio playback\n};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"app-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Empathy AI\"}),/*#__PURE__*/_jsx(\"p\",{children:\"A safe space to share your thoughts and feelings\"})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"app-main\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"support-message\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"You're Not Alone\"}),/*#__PURE__*/_jsx(\"p\",{children:\"This is a judgment-free space where you can express yourself freely. Our AI companion is here to listen with empathy and provide supportive guidance.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"recording-section\",children:[/*#__PURE__*/_jsx(AudioRecorder,{onRecordingComplete:handleRecordingComplete,onProcessingComplete:()=>{}// Empty callback as auto-resume is handled internally\n,isProcessing:isProcessing,conversationUuid:currentConversationUuid,onStartNewConversation:handleStartNewConversation,onEndConversation:handleEndConversation,onWebSocketMessage:handleWebSocketMessage,onWebSocketError:handleWebSocketError}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u26A0\\uFE0F \",error]}),/*#__PURE__*/_jsx(\"small\",{children:\"Please try again or check your connection.\"})]}),currentResponse&&currentResponse.success&&/*#__PURE__*/_jsx(AudioPlayer,{audioUrl:currentResponse.audioUrl||null,message:currentResponse.message,onPlaybackComplete:handlePlaybackComplete})]}),/*#__PURE__*/_jsx(TranscriptionHistory,{conversations:conversations})]})]})]});}export default App;","map":{"version":3,"names":["React","useState","AudioRecorder","AudioPlayer","TranscriptionHistory","jsx","_jsx","jsxs","_jsxs","generateUUID","replace","c","r","Math","random","v","toString","App","isProcessing","setIsProcessing","currentResponse","setCurrentResponse","error","setError","conversations","setConversations","currentConversationUuid","setCurrentConversationUuid","handleRecordingComplete","audioBlob","console","log","handleWebSocketMessage","message","type","transcription","userMessage","id","Date","now","timestamp","content","prev","updatedConversations","length","currentMessages","messages","transcriptionReply","aiMessage","needHumanIntervention","handleWebSocketError","handleStartNewConversation","uuid","newConversation","startTime","handleEndConversation","handlePlaybackComplete","className","children","onRecordingComplete","onProcessingComplete","conversationUuid","onStartNewConversation","onEndConversation","onWebSocketMessage","onWebSocketError","success","audioUrl","onPlaybackComplete"],"sources":["/Users/jiginvp/react/AICompetition/empathy-ai/src/App.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport './App.css';\nimport AudioRecorder from './components/AudioRecorder';\nimport AudioPlayer from './components/AudioPlayer';\nimport TranscriptionHistory, { Conversation, ChatMessage } from './components/TranscriptionHistory';\nimport { WebSocketMessage } from './services/webSocketService';\n\n// Generate UUID function\nconst generateUUID = (): string => {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = Math.random() * 16 | 0;\n    const v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n};\n\nfunction App() {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [currentResponse, setCurrentResponse] = useState<any | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [currentConversationUuid, setCurrentConversationUuid] = useState<string | null>(null);\n\n  const handleRecordingComplete = async (audioBlob: Blob) => {\n    // This is now handled by WebSocket, keeping for compatibility\n    console.log('Recording complete - WebSocket mode');\n  };\n\n  const handleWebSocketMessage = (message: WebSocketMessage) => {\n    console.log('Received WebSocket message:', message);\n    \n    if (message.type === 'transcription' && message.transcription) {\n      // Add user message with transcription\n      const userMessage: ChatMessage = {\n        id: Date.now().toString(),\n        timestamp: new Date(),\n        type: 'user',\n        content: message.transcription,\n      };\n      \n      setConversations(prev => {\n        const updatedConversations = [...prev];\n        if (updatedConversations.length > 0) {\n          const currentMessages = [...updatedConversations[0].messages, userMessage];\n          updatedConversations[0] = {\n            ...updatedConversations[0],\n            messages: currentMessages\n          };\n        }\n        return updatedConversations;\n      });\n    }\n    \n    if (message.type === 'ai_response' && message.transcriptionReply) {\n      // Add AI response message\n      const aiMessage: ChatMessage = {\n        id: (Date.now() + 1).toString(),\n        timestamp: new Date(),\n        type: 'ai',\n        content: message.transcriptionReply,\n        needHumanIntervention: message.needHumanIntervention || false,\n      };\n      \n      setConversations(prev => {\n        const updatedConversations = [...prev];\n        if (updatedConversations.length > 0) {\n          const currentMessages = [...updatedConversations[0].messages, aiMessage];\n          updatedConversations[0] = {\n            ...updatedConversations[0],\n            messages: currentMessages\n          };\n        }\n        return updatedConversations;\n      });\n    }\n    \n    if (message.error) {\n      setError(message.error);\n    }\n  };\n  \n  const handleWebSocketError = (error: string) => {\n    console.error('WebSocket error:', error);\n    setError(error);\n  };\n\n  const handleStartNewConversation = (): string => {\n    const uuid = generateUUID();\n    setCurrentConversationUuid(uuid);\n    \n    // Create new conversation\n    const newConversation: Conversation = {\n      id: uuid,\n      messages: [],\n      startTime: new Date(),\n    };\n    \n    setConversations(prev => [newConversation, ...prev]);\n    console.log('Started new conversation with UUID:', uuid);\n    return uuid;\n  };\n\n  const handleEndConversation = () => {\n    setCurrentConversationUuid(null);\n    console.log('Ended conversation');\n  };\n\n  const handlePlaybackComplete = () => {\n    // Optional: Add any cleanup or next steps after audio playback\n  };\n\n  return (\n    <div className=\"App\">\n      <header className=\"app-header\">\n        <h1>Empathy AI</h1>\n        <p>A safe space to share your thoughts and feelings</p>\n      </header>\n\n      <main className=\"app-main\">\n        <div className=\"support-message\">\n          <h2>You're Not Alone</h2>\n          <p>\n            This is a judgment-free space where you can express yourself freely. \n            Our AI companion is here to listen with empathy and provide supportive guidance.\n          </p>\n        </div>\n\n        <div className=\"main-content\">\n          <div className=\"recording-section\">\n            <AudioRecorder \n              onRecordingComplete={handleRecordingComplete}\n              onProcessingComplete={() => {}} // Empty callback as auto-resume is handled internally\n              isProcessing={isProcessing}\n              conversationUuid={currentConversationUuid}\n              onStartNewConversation={handleStartNewConversation}\n              onEndConversation={handleEndConversation}\n              onWebSocketMessage={handleWebSocketMessage}\n              onWebSocketError={handleWebSocketError}\n            />\n\n            {error && (\n              <div className=\"error-message\">\n                <p>⚠️ {error}</p>\n                <small>Please try again or check your connection.</small>\n              </div>\n            )}\n\n            {currentResponse && currentResponse.success && (\n              <AudioPlayer\n                audioUrl={currentResponse.audioUrl || null}\n                message={currentResponse.message}\n                onPlaybackComplete={handlePlaybackComplete}\n              />\n            )}\n          </div>\n\n          <TranscriptionHistory conversations={conversations} />\n        </div>\n\n      </main>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}